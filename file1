pipeline {
    agent any
 
    parameters {
        // Active Choices Parameter for Branches
        choiceParam(
            name: 'BRANCH',
            choices: getBranches(),
            description: 'Select the branch'
        )
 
        // Active Choices Parameter for Commit IDs
        choiceParam(
            name: 'COMMIT_ID',
            description: 'Select the commit ID',
            filterable: true,
            script: script {
                def branchName = BRANCH
                if (!branchName) return ['Please select a branch']
                return getCommits(branchName)
            }
        )
    }
 
    stages {
        stage('Clone Repository') {
            steps {
                script {
                    def repoUrl = 'https://github.com/GUMMASAISINDHU/ecommerce-website.git'
                    git branch: "${params.BRANCH}", url: "${repoUrl}"
                }
            }
        }
        stage('Build') {
            steps {
                script {
                    echo "Building branch ${params.BRANCH} at commit ${params.COMMIT_ID}"
                    // Your build steps here
                }
            }
        }
    }
}
 
def getBranches() {
    def branches = []
    def proc = "git ls-remote --heads https://github.com/GUMMASAISINDHU/ecommerce-website.git".execute()
    proc.in.eachLine { line ->
        def branch = line.split()[1].replaceAll('refs/heads/', '')
        branches << branch
    }
    return branches
}
 
def getCommits(branchName) {
    def commits = []
    def proc = "git log --pretty=format:'%H' -n 5 origin/${branchName}".execute()
    proc.in.eachLine { line ->
        def commit = line
        commits << commit
    }
    return commits
}


