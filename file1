from flask import Flask, render_template, request
import subprocess

app = Flask(__name__)

def get_branches_and_commits():
    branches = subprocess.check_output(["git", "branch", "-a"]).decode('utf-8').split('\n')
    branches = [branch.strip() for branch in branches if branch]
    commits = {branch: subprocess.check_output(["git", "rev-parse", branch]).decode('utf-8').strip() for branch in branches}
    return branches, commits

@app.route('/')
def index():
    branches, commits = get_branches_and_commits()
    return render_template('index.html', branches=branches, commits=commits)

@app.route('/build', methods=['POST'])
def build():
    branch = request.form['branch']
    commit_id = request.form['commit_id']
    # Trigger the build process with the selected branch and commit ID
    return f"Triggered build for branch {branch} at commit {commit_id}"

if __name__ == '__main__':
    app.run(debug=True)
