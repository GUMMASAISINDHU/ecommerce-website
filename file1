pipeline {
    agent any

    parameters {
        // Active Choices Parameter for Branches
        choiceParam(
            name: 'BRANCH',
            choices: getBranches(),
            description: 'Select the branch'
        )
        // Active Choices Parameter for Commit IDs
        choiceParam(
            name: 'COMMIT_ID',
            choices: getCommits(),
            description: 'Select the commit ID'
        )
    }

    environment {
        REPO_URL = 'https://github.com/GUMMASAISINDHU/ecommerce-website.git'
    }

    stages {
        stage('Clone Repository') {
            steps {
                script {
                    git url: REPO_URL, branch: params.BRANCH
                }
            }
        }
        stage('Build') {
            steps {
                script {
                    echo "Building branch ${params.BRANCH} at commit ${params.COMMIT_ID}"
                    // Your build steps here
                }
            }
        }
    }
}

def getBranches() {
    def branches = []
    def proc = "git ls-remote --heads ${env.REPO_URL}".execute()
    proc.in.eachLine { line ->
        def branch = line.split()[1].replaceAll('refs/heads/', '')
        branches << branch
    }
    return branches
}

def getCommits() {
    def commits = []
    if (params.BRANCH) {
        def proc = "git ls-remote ${env.REPO_URL} refs/heads/${params.BRANCH}".execute()
        proc.in.eachLine { line ->
            def commit = line.split()[0]
            commits << commit
        }
    }
    return commits
}

