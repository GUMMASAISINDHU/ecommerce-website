pipeline {
    agent any
    
    parameters {
        string(
            name: 'GIT_REPO',
            defaultValue: 'https://github.com/GUMMASAISINDHU/ecommerce-website.git',
            description: 'Input Git Repo (https) Url'
        )
        choice(
            name: 'BRANCH',
            choices: getBranches(),
            description: 'Branch'
        )
        choice(
            name: 'COMMIT_ID',
            choices: getCommitIds(params.BRANCH),
            description: 'COMMIT_ID'
        )
    }

    stages {
        stage('Build') {
            steps {
                echo "Building branch ${params.BRANCH} at commit ${params.COMMIT_ID}"
                // Your build steps here
            }
        }
    }
}

def getBranches() {
    def branches = []
    def proc = "git ls-remote --heads ${params.GIT_REPO}".execute()
    proc.in.eachLine { line ->
        def branch = line.split()[1].replaceAll('refs/heads/', '')
        branches << branch
    }
    return branches
}

def getCommitIds(branch) {
    def commitIds = []
    def proc = "git ls-remote ${params.GIT_REPO} refs/heads/${branch}".execute()
    proc.in.eachLine { line ->
        def commitId = line.split()[0]
        commitIds << commitId
    }
    return commitIds
}
