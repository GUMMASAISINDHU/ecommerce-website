pipeline {
    agent any

    environment {
        REPO_URL = 'https://github.com/GUMMASAISINDHU/ecommerce-website.git'
    }

    parameters {
        choice(name: 'BRANCH', choices: getBranches(), description: 'Select the branch')
        choice(name: 'COMMIT_ID', choices: getCommits(params.BRANCH), description: 'Select the commit ID')
    }

    stages {
        stage('Clone Repository') {
            steps {
                script {
                    git url: REPO_URL, branch: params.BRANCH
                }
            }
        }
        stage('Build') {
            steps {
                script {
                    // Your build steps here
                }
            }
        }
    }
}

def getBranches() {
    def branches = []
    def proc = "git ls-remote --heads ${env.REPO_URL}".execute()
    proc.in.eachLine { line ->
        def branch = line.split()[1].replaceAll('refs/heads/', '')
        branches << branch
    }
    return branches.join('\n')
}

def getCommits(branch) {
    if (!branch) return 'Select a branch first'
    def commits = []
    def proc = "git ls-remote ${env.REPO_URL} refs/heads/${branch}".execute()
    proc.in.eachLine { line ->
        def commit = line.split()[0]
        commits << commit
    }
    return commits.join('\n')
}
